{% extends "inventory/base.html" %}
{% load static %}
{% load humanize %}


{% block extra_css %}
<link rel="stylesheet" href="{% static 'inventory/css/category_list.css' %}">
{% endblock %}


{% block content %}
<div class="categories-container">
    <h2 class="page-title">ðŸ“‚ Categorias</h2>
    <a href="{% url 'create_category' %}" class="btn-add">+ Nova Categoria</a>

    {% if categories %}

    <div class="filter-bar">
        <form method="get" class="filter-form">
            <label for="sort">Ordenar por:</label>
            <select name="sort" id="sort" onchange="this.form.submit()">
                <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Nome A-Z</option>
                <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Nome Z-A</option>
                <option value="value_asc" {% if sort == 'value_asc' %}selected{% endif %}>Menor valor em estoque</option>
                <option value="value_desc" {% if sort == 'value_desc' %}selected{% endif %}>Maior valor em estoque</option>
            </select>
        </form>
    </div>

    
    {% for category in categories %}
    <a href="{% url 'category_detail' category.pk %}" class="category-link">

        <div class="category-card">
            <h3 class="category-title">{{ category.category }}</h3>
        
            <p class="category-value">
                ðŸ’° Valor total em estoque:
                <strong>
                    {% if category.total_value %}
                        R$ {{ category.total_value|floatformat:2|intcomma }}
                    {% else %}
                        R$ 0.00
                    {% endif %}
                </strong>
            </p>
        
            {% if category.subcategories.all %}
                <ul class="subcategory-list">
                    {% for sub in category.subcategories.all %}
                        <li class="subcategory-item">{{ sub.subcategory }}</li>
                    {% empty %}
                        <li class="empty-subcategory">Sem subcategorias</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-subcategory">Sem subcategorias</p>
            {% endif %}
        </div>
    </a>
    {% empty %}
        <div class="empty-container">
            <p class="empty-text">Nenhuma categoria cadastrada.</p>
            <a href="{% url 'create_category' %}" class="btn-add">âž• Cadastrar Categoria</a>
        </div>
    {% endfor %}
{% else %}
    <div class="empty-container">
        <p class="empty-text">Nenhuma categoria encontrada no sistema.</p>
        <a href="{% url 'create_category' %}" class="btn-add">âž• Cadastrar Categoria</a>
    </div>
{% endif %}


</div>
{% endblock %}
